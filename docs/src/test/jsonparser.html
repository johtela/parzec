
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>
            parzec - Parsing JSON
        </title>
        <link rel="icon" type="image/icon" href="../../images/favicon.svg" />
        <link rel="stylesheet" href="../../dist/normal.css" />
        
    </head>
    <body data-syntax-highlight="monokai"
        data-theme="purple-rain">
        
        <div id="navbar">
            
    <div class="navmenu ">
        
    <div class="navitem " >
        <a class="title enabled" href="../../index.html" >
            <img src="../../images/millenniumfalcon_88882.svg" />
            <span>parzec</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://www.npmjs.com/package/parzec" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-npm" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M1 8h22v7h-12v2h-4v-2h-6z" />
            <path d="M7 8v7" />
            <path d="M14 8v7" />
            <path d="M17 11v4" />
            <path d="M4 11v4" />
            <path d="M11 11v1" />
            <path d="M20 11v4" />
        </svg>
            <span>Download</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a class="enabled" href="https://github.com/johtela/parzec" >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
        </svg>
            <span>GitHub</span>
        </a>
        
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Syntax Highlight</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="coding-horror">
        <a   onclick="document.body.syntaxHighlight('coding-horror')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Coding Horror</span>
        </a>
        
    </div>
    <div class="navitem active" id="monokai">
        <a   onclick="document.body.syntaxHighlight('monokai')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Monokai</span>
        </a>
        
    </div>
    <div class="navitem " id="solarized-light">
        <a   onclick="document.body.syntaxHighlight('solarized-light')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Solarized Light</span>
        </a>
        
    </div>
    <div class="navitem " id="son-of-obsidian">
        <a   onclick="document.body.syntaxHighlight('son-of-obsidian')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-palette" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25" />
            <path d="M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
            <path d="M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
        </svg>
            <span>Son of Obsidian</span>
        </a>
        
    </div>
    </div>
    </div>
    <div class="navitem " >
        <a   >
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-caret-down" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 10l6 6l6 -6h-12" />
        </svg>
            <span>Theme</span>
        </a>
        
    <div class="navmenu toggle">
        
    <div class="navitem " id="blueberry">
        <a   onclick="document.body.theme('blueberry')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Blueberry</span>
        </a>
        
    </div>
    <div class="navitem " id="book-cover">
        <a   onclick="document.body.theme('book-cover')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Book Cover</span>
        </a>
        
    </div>
    <div class="navitem " id="brownie">
        <a   onclick="document.body.theme('brownie')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Brownie</span>
        </a>
        
    </div>
    <div class="navitem " id="chocolate">
        <a   onclick="document.body.theme('chocolate')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Chocolate</span>
        </a>
        
    </div>
    <div class="navitem " id="ice-age">
        <a   onclick="document.body.theme('ice-age')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Ice Age</span>
        </a>
        
    </div>
    <div class="navitem " id="monotone">
        <a   onclick="document.body.theme('monotone')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Monotone</span>
        </a>
        
    </div>
    <div class="navitem " id="mustard">
        <a   onclick="document.body.theme('mustard')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Mustard</span>
        </a>
        
    </div>
    <div class="navitem " id="peachy">
        <a   onclick="document.body.theme('peachy')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Peachy</span>
        </a>
        
    </div>
    <div class="navitem " id="red-alert">
        <a   onclick="document.body.theme('red-alert')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Red Alert</span>
        </a>
        
    </div>
    <div class="navitem " id="ultra-violet">
        <a   onclick="document.body.theme('ultra-violet')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Ultra Violet</span>
        </a>
        
    </div>
    <div class="navitem " id="vintage">
        <a   onclick="document.body.theme('vintage')">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-paint" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z" />
            <path d="M19 6h1a2 2 0 0 1 2 2a5 5 0 0 1 -5 5l-5 0v2" />
            <path d="M10 15m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z" />
        </svg>
            <span>Vintage</span>
        </a>
        
    </div>
    </div>
    </div>
    </div>
            
    <a class="hamburger">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
    </a>
        </div>
        
        <div class="layout">
            <div class="sidepane narrow-scrollbars">
                
        <div class="tocmenu">
            <h3>Table of Contents</h3>
            
    <ul>
        
    <li>
        <a href="../../README.html"><span>ðŸ“”</span>Introduction</a>
    </li>
    <li>
        
    <div class="accordion">
        Examples
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="exprparser.html"><span>ðŸ“”</span>Parsing Arithmetic Epressions</a>
    </li>
    <li>
        <a href="exprtests.html"><span>ðŸ“”</span>Testing the Expression Parser</a>
    </li>
    <li>
        <a href="jsonparser.html" class="highlight"><span>ðŸ“”</span>Parsing JSON</a>
    </li>
    <li>
        <a href="jsontests.html"><span>ðŸ“”</span>Testing the JSON Parser</a>
    </li>
    </ul>
    </li>
    <li>
        
    <div class="accordion">
        Implementation
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M6 15l6 -6l6 6" />
        </svg>
    </div>
    
    <ul>
        
    <li>
        <a href="../index.html"><span>ðŸ“”</span>Library Structure</a>
    </li>
    <li>
        <a href="../input.html"><span>ðŸ“”</span>Parser Input</a>
    </li>
    <li>
        <a href="../result.html"><span>ðŸ“”</span>Parser Result</a>
    </li>
    <li>
        <a href="../error.html"><span>ðŸ“”</span>Error Reporting</a>
    </li>
    <li>
        <a href="../ref.html"><span>ðŸ“”</span>Reference Cells</a>
    </li>
    <li>
        <a href="../lexer.html"><span>ðŸ“”</span>Lexical Analyzer</a>
    </li>
    <li>
        <a href="../parser.html"><span>ðŸ“”</span>Parser Monad and Combinators</a>
    </li>
    <li>
        <a href="../arrayparsers.html"><span>ðŸ“”</span>Parsing Arrays and Expressions</a>
    </li>
    <li>
        <a href="../utils.html"><span>ðŸ“”</span>Utility Functions</a>
    </li>
    </ul>
    </li>
    <li>
        <a href="../../license.html"><span>ðŸ“”</span>License</a>
    </li>
    </ul>
        </div>
                <div class="toc-button"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M7 7l5 5l-5 5" />
            <path d="M13 7l5 5l-5 5" />
        </svg></div>
            </div>
            
        <div class="contentarea closepopups">
            <h1 id="parsing-json">Parsing JSON</h1>
<p>The next example parser converts JSON strings to JavaScript objects. It
effectively does the same thing as the <code>JSON.parse</code> function. So, it serves
no practical purpose, but is a nice example due to simplicity of the JSON
grammar. To make our implementation marginally more useful, let's allow to
include comments inside JSON.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">import</span> <span class="punctuation">*</span> <span class="keyword">as</span> <span id="389" data-toggle="tooltip" data-title="typeof pz">pz</span> <span class="keyword">from</span> <span class="string">&quot;..&quot;</span><span class="punctuation">;</span>
</code></pre>
<h2 id="tokens">Tokens</h2>
<p>First we define all the tokens that JSON files may contain. These are all
specified in <a href="https://www.json.org">json.org</a>.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">enum</span> <span id="408" class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span> <span class="punctuation">{</span>
    <span id="613" data-toggle="tooltip" data-title="JsonToken.True">True</span><span class="punctuation">,</span> <span id="624" data-toggle="tooltip" data-title="JsonToken.False">False</span><span class="punctuation">,</span> <span id="631" data-toggle="tooltip" data-title="JsonToken.Null">Null</span><span class="punctuation">,</span> <span id="637" data-toggle="tooltip" data-title="JsonToken.LeftBrace">LeftBrace</span><span class="punctuation">,</span> <span id="648" data-toggle="tooltip" data-title="JsonToken.RightBrace">RightBrace</span><span class="punctuation">,</span> <span id="660" data-toggle="tooltip" data-title="JsonToken.LeftBracket">LeftBracket</span><span class="punctuation">,</span> <span id="673" data-toggle="tooltip" data-title="JsonToken.RightBracket">RightBracket</span><span class="punctuation">,</span> <span id="687" data-toggle="tooltip" data-title="JsonToken.Comma">Comma</span><span class="punctuation">,</span>
    <span id="694" data-toggle="tooltip" data-title="JsonToken.Colon">Colon</span><span class="punctuation">,</span> <span id="706" data-toggle="tooltip" data-title="JsonToken.Number">Number</span><span class="punctuation">,</span> <span id="714" data-toggle="tooltip" data-title="JsonToken.String">String</span><span class="punctuation">,</span> <span id="722" data-toggle="tooltip" data-title="JsonToken.Whitespace">Whitespace</span><span class="punctuation">,</span> <span id="734" data-toggle="tooltip" data-title="JsonToken.Comment">Comment</span><span class="punctuation">,</span> <span id="743" data-toggle="tooltip" data-title="JsonToken.EOF">EOF</span>
<span class="punctuation">}</span>
</code></pre>
<details>
<summary>Debug settings</summary>
<pre class="syntaxhighlight narrow-scrollbars"><code><a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#9606"><span data-toggle="tooltip" data-title="{ debugging: boolean; rulesEvaluated: number; errorMessages: boolean; indentation: number; indent(): void; unindent(): void; write(text: string): void; }">parserDebug</span></a><span class="punctuation">.</span><a href="../parser.html#9622"><span data-toggle="tooltip" data-title="boolean">debugging</span></a> <span class="punctuation">=</span> <span class="keyword">false</span>
</code></pre>
</details>
<h2 id="lexer">Lexer</h2>
<p><img src="../../images/number.png" alt="number">
We define lexers for all the tokens. First we handle constants and separator
characters. They are trivial to recognize.</p>
<p>Numbers are a bit trickier as we need to support decimal formats with
and without exponents.</p>
<p><img src="../../images/string.png" alt="string">
Strings can be a bit tricky as well, as there are special characters that
have to be accounted for. Another notable thing is that we need to use the
<code>u</code> specifier in our regex for unicode support.</p>
<p><img src="../../images/whitespace.png" alt="string">
Below we see how whitespace is scanned in JSON. We'll add a lexer for inline
comments <code>//...</code> as well.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="1549" data-toggle="tooltip" data-title="pz.Lexer&lt;JsonToken&gt;">lexer</span> <span class="punctuation">=</span> <span class="keyword">new</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#1693"><span class="typename" data-toggle="tooltip" data-title="typeof pz.Lexer">Lexer</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span>
    <span class="punctuation">[</span><span class="string">/true/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#613"><span data-toggle="tooltip" data-title="JsonToken.True">True</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/false/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#624"><span data-toggle="tooltip" data-title="JsonToken.False">False</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/null/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#631"><span data-toggle="tooltip" data-title="JsonToken.Null">Null</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/\{/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#637"><span data-toggle="tooltip" data-title="JsonToken.LeftBrace">LeftBrace</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/\}/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#648"><span data-toggle="tooltip" data-title="JsonToken.RightBrace">RightBrace</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/\[/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#660"><span data-toggle="tooltip" data-title="JsonToken.LeftBracket">LeftBracket</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/\]/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#673"><span data-toggle="tooltip" data-title="JsonToken.RightBracket">RightBracket</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/,/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#687"><span data-toggle="tooltip" data-title="JsonToken.Comma">Comma</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/:/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#694"><span data-toggle="tooltip" data-title="JsonToken.Colon">Colon</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/-?(?:[1-9]\d+|\d(?!\d))(?:\.\d+)?(?:[eE][+-]?\d+)?/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#706"><span data-toggle="tooltip" data-title="JsonToken.Number">Number</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/&quot;(?:(?:(?![&quot;\\])[\u{0020}-\u{ffff}])|(?:\\(?:[&quot;\\\/bnfrt]|(?:u[0-9a-fA-F]{4}))))*&quot;/u</span><span class="punctuation">,</span>
        <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#714"><span data-toggle="tooltip" data-title="JsonToken.String">String</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/[\t\n\r ]+/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#722"><span data-toggle="tooltip" data-title="JsonToken.Whitespace">Whitespace</span></a><span class="punctuation">]</span><span class="punctuation">,</span>
    <span class="punctuation">[</span><span class="string">/\/\/[^\n\r]*/</span><span class="punctuation">,</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#734"><span data-toggle="tooltip" data-title="JsonToken.Comment">Comment</span></a><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">;</span>
</code></pre>
<h2 id="terminals">Terminals</h2>
<p>With tokens defined, parsers for terminals are trivial to write. Note how
we map the terminals to JavaScript types. We even cheat a bit, and convert
strings using <code>JSON.parse</code>. We skip the trailing whitespace (including
comments) for each token which makes our other rules simpler.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="2501" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">comment</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17483"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(token: T) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">token</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#734"><span data-toggle="tooltip" data-title="JsonToken.Comment">Comment</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="2546" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17483"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(token: T) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">token</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#722"><span data-toggle="tooltip" data-title="JsonToken.Whitespace">Whitespace</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#2607"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(other: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt; | U, pz.Token&lt;JsonToken&gt;&gt;">or</span></a><span class="punctuation">(</span><a href="jsonparser.html#2501"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">comment</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#4151"><span class="member" data-toggle="tooltip" data-title="() =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">zeroOrMore</span></a><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="2622" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">number</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#706"><span data-toggle="tooltip" data-title="JsonToken.Number">Number</span></a><span class="punctuation">,</span> <span class="string">&quot;&lt;number&gt;&quot;</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../parser.html#2286"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(mapper: (value: pz.Token&lt;JsonToken&gt;) =&gt; U) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">map</span></a><span class="punctuation">(</span><span id="2684" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span> <span class="punctuation">=&gt;</span> <span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">&gt;</span><span class="typename" data-toggle="tooltip" data-title="NumberConstructor">Number</span><span class="punctuation">(</span><a href="jsonparser.html#2684"><span data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span></a><span class="punctuation">.</span><a href="../lexer.html#1456"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="2739" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">string</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#714"><span data-toggle="tooltip" data-title="JsonToken.String">String</span></a><span class="punctuation">,</span> <span class="string">&quot;&lt;string&gt;&quot;</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../parser.html#2286"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(mapper: (value: pz.Token&lt;JsonToken&gt;) =&gt; U) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">map</span></a><span class="punctuation">(</span><span id="2801" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span> <span class="punctuation">=&gt;</span> <span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">&gt;</span><span class="typename" data-toggle="tooltip" data-title="JSON">JSON</span><span class="punctuation">.</span><span class="member" data-toggle="tooltip" data-title="(text: string, reviver?: ((this: any, key: string, value: any) =&gt; any) | undefined) =&gt; any">parse</span><span class="punctuation">(</span><a href="jsonparser.html#2801"><span data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span></a><span class="punctuation">.</span><a href="../lexer.html#1456"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="2860" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">littrue</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#613"><span data-toggle="tooltip" data-title="JsonToken.True">True</span></a><span class="punctuation">,</span> <span class="string">&quot;true&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#2286"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(mapper: (value: pz.Token&lt;JsonToken&gt;) =&gt; U) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">map</span></a><span class="punctuation">(</span><span id="2911" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span> <span class="punctuation">=&gt;</span> <span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">&gt;</span><span class="keyword">true</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="2962" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">litfalse</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#624"><span data-toggle="tooltip" data-title="JsonToken.False">False</span></a><span class="punctuation">,</span> <span class="string">&quot;false&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#2286"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(mapper: (value: pz.Token&lt;JsonToken&gt;) =&gt; U) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">map</span></a><span class="punctuation">(</span><span id="3016" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span> <span class="punctuation">=&gt;</span> <span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">&gt;</span><span class="keyword">false</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3068" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">litnull</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#631"><span data-toggle="tooltip" data-title="JsonToken.Null">Null</span></a><span class="punctuation">,</span> <span class="string">&quot;null&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#2286"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(mapper: (value: pz.Token&lt;JsonToken&gt;) =&gt; U) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">map</span></a><span class="punctuation">(</span><span id="3119" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">t</span> <span class="punctuation">=&gt;</span> <span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">&gt;</span><span class="keyword">null</span><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3170" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">comma</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#687"><span data-toggle="tooltip" data-title="JsonToken.Comma">Comma</span></a><span class="punctuation">,</span> <span class="string">&quot;,&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3242" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">colon</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#694"><span data-toggle="tooltip" data-title="JsonToken.Colon">Colon</span></a><span class="punctuation">,</span> <span class="string">&quot;:&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3314" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">beginarray</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#660"><span data-toggle="tooltip" data-title="JsonToken.LeftBracket">LeftBracket</span></a><span class="punctuation">,</span> <span class="string">&quot;[&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3397" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">endarray</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#673"><span data-toggle="tooltip" data-title="JsonToken.RightBracket">RightBracket</span></a><span class="punctuation">,</span> <span class="string">&quot;]&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3479" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">beginobject</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#637"><span data-toggle="tooltip" data-title="JsonToken.LeftBrace">LeftBrace</span></a><span class="punctuation">,</span> <span class="string">&quot;{&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3561" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">endobject</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#648"><span data-toggle="tooltip" data-title="JsonToken.RightBrace">RightBrace</span></a><span class="punctuation">,</span> <span class="string">&quot;}&quot;</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="3642" data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">eof</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#17684"><span class="member" data-toggle="tooltip" data-title="&lt;T&gt;(tok: T, name: string) =&gt; pz.Parser&lt;pz.Token&lt;T&gt;, pz.Token&lt;T&gt;&gt;">terminal</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#743"><span data-toggle="tooltip" data-title="JsonToken.EOF">EOF</span></a><span class="punctuation">,</span> <span class="string">&quot;&lt;end of input&gt;&quot;</span><span class="punctuation">)</span>
</code></pre>
<h2 id="nonterminals">Nonterminals</h2>
<p>Now we can define parsers for nonterminals, the abstract and recursive part
of the grammar. <code>element</code> is a recursive parsing rule that we need to define
later since it depends on other rules. We create a reference cell for it and
then define that multiple elements can be separated by comma.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="4047" data-toggle="tooltip" data-title="pz.Ref&lt;pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;&gt;">element</span> <span class="punctuation">=</span> <span class="keyword">new</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../ref.html#0"><span class="typename" data-toggle="tooltip" data-title="typeof pz.Ref">Ref</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="any">pz</span></a><span class="punctuation">.</span><a href="../parser.html#870"><span class="typename" data-toggle="tooltip" data-title="pz.Parser&lt;T, S&gt;">Parser</span></a><span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">,</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="any">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#1200"><span class="typename" data-toggle="tooltip" data-title="pz.Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><span class="punctuation">)</span>
<span class="keyword">const</span> <span id="4114" data-toggle="tooltip" data-title="pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">elements</span> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#16514"><span class="member" data-toggle="tooltip" data-title="&lt;T, S&gt;(parser: pz.Ref&lt;pz.Parser&lt;T, S&gt;&gt;) =&gt; pz.Parser&lt;T, S&gt;">forwardRef</span></a><span class="punctuation">(</span><a href="jsonparser.html#4047"><span data-toggle="tooltip" data-title="pz.Ref&lt;pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;&gt;">element</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#700"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(separator: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">zeroOrMoreSeparatedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#3170"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">comma</span></a><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;elements&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>An array consists of list of elements separated by comma and bracketed by
<code>[</code> and <code>]</code>.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="4314" data-toggle="tooltip" data-title="pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">array</span> <span class="punctuation">=</span> <a href="jsonparser.html#4114"><span data-toggle="tooltip" data-title="pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">elements</span></a><span class="punctuation">.</span><a href="../arrayparsers.html#896"><span class="member" data-toggle="tooltip" data-title="&lt;U, V&gt;(open: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;, close: pz.Parser&lt;V, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">bracketedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#3314"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">beginarray</span></a><span class="punctuation">,</span> <a href="jsonparser.html#3397"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">endarray</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;array&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>A member (of an object) consist of a string key, a colon, and an element.
The <code>member</code> parser returns a [<em>key</em>, <em>value</em>] pair. The <code>members</code> parses a
list of members separated by commas and returns array of pairs.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="4625" data-toggle="tooltip" data-title="pz.Parser&lt;[string, any], pz.Token&lt;JsonToken&gt;&gt;">member</span> <span class="punctuation">=</span> <a href="jsonparser.html#2739"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">string</span></a><span class="punctuation">.</span><a href="../parser.html#1229"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(binder: (value: any) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">bind</span></a><span class="punctuation">(</span>
        <span id="4647" data-toggle="tooltip" data-title="any">s</span> <span class="punctuation">=&gt;</span> <a href="jsonparser.html#3242"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">colon</span></a><span class="punctuation">.</span><a href="../parser.html#1229"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(binder: (value: pz.Token&lt;JsonToken&gt;) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">bind</span></a><span class="punctuation">(</span>
        <span id="4673" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">c</span> <span class="punctuation">=&gt;</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#16514"><span class="member" data-toggle="tooltip" data-title="&lt;T, S&gt;(parser: pz.Ref&lt;pz.Parser&lt;T, S&gt;&gt;) =&gt; pz.Parser&lt;T, S&gt;">forwardRef</span></a><span class="punctuation">(</span><a href="jsonparser.html#4047"><span data-toggle="tooltip" data-title="pz.Ref&lt;pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;&gt;">element</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#1229"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(binder: (value: any) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">bind</span></a><span class="punctuation">(</span>
        <span id="4716" data-toggle="tooltip" data-title="any">e</span> <span class="punctuation">=&gt;</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#11476"><span class="member" data-toggle="tooltip" data-title="&lt;T, S&gt;(value: T) =&gt; pz.Parser&lt;T, S&gt;">mret</span></a><span class="punctuation">(</span><span class="punctuation">&lt;</span><span class="punctuation">[</span><span class="keyword">string</span><span class="punctuation">,</span> <span class="keyword">any</span><span class="punctuation">]</span><span class="punctuation">&gt;</span><span class="punctuation">[</span><a href="jsonparser.html#4647"><span data-toggle="tooltip" data-title="any">s</span></a><span class="punctuation">,</span> <a href="jsonparser.html#4716"><span data-toggle="tooltip" data-title="any">e</span></a><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>
        <span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;[string, any], pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;member&quot;</span><span class="punctuation">)</span>                        
<span class="keyword">const</span> <span id="4821" data-toggle="tooltip" data-title="pz.Parser&lt;[string, any][], pz.Token&lt;JsonToken&gt;&gt;">members</span> <span class="punctuation">=</span> <a href="jsonparser.html#4625"><span data-toggle="tooltip" data-title="pz.Parser&lt;[string, any], pz.Token&lt;JsonToken&gt;&gt;">member</span></a><span class="punctuation">.</span><a href="../arrayparsers.html#700"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(separator: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;[string, any][], pz.Token&lt;JsonToken&gt;&gt;">zeroOrMoreSeparatedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#3170"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">comma</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;[string, any][], pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;members&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>An object is list of members surrounded by <code>{</code> and <code>}</code>. The parser returns a
JavaScript object which is created by the <code>initObject</code> helper function. It
constructs an object from an array of [<em>key</em>, <em>value</em>] pairs.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="5129" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">object</span> <span class="punctuation">=</span> <a href="jsonparser.html#4821"><span data-toggle="tooltip" data-title="pz.Parser&lt;[string, any][], pz.Token&lt;JsonToken&gt;&gt;">members</span></a><span class="punctuation">.</span><a href="../arrayparsers.html#896"><span class="member" data-toggle="tooltip" data-title="&lt;U, V&gt;(open: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;, close: pz.Parser&lt;V, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;[string, any][], pz.Token&lt;JsonToken&gt;&gt;">bracketedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#3479"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">beginobject</span></a><span class="punctuation">,</span> <a href="jsonparser.html#3561"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">endobject</span></a><span class="punctuation">)</span>
    <span class="punctuation">.</span><a href="../parser.html#2286"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(mapper: (value: [string, any][]) =&gt; U) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">map</span></a><span class="punctuation">(</span><span id="5193" data-toggle="tooltip" data-title="[string, any][]">ms</span> <span class="punctuation">=&gt;</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../utils.html#0"><span class="member" data-toggle="tooltip" data-title="(members: [string, any][]) =&gt; any">initObject</span></a><span class="punctuation">(</span><a href="jsonparser.html#5193"><span data-toggle="tooltip" data-title="[string, any][]">ms</span></a><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;object&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>Now we can define the <code>element</code> rule. It chooses the next parser to be
applied based on a lookahead token. If it is a left brace or bracket, we
parse an object or an array respectively. If it is a primitive element
(string, number, boolean, or null), we jump directly to the correct parser.
This speeds up parsing as we don't need to use the <code>or</code> combinator, which
tries alternative parsers in turn.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><a href="jsonparser.html#4047"><span data-toggle="tooltip" data-title="pz.Ref&lt;pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;&gt;">element</span></a><span class="punctuation">.</span><a href="../ref.html#750"><span class="member" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">target</span></a> <span class="punctuation">=</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#14060"><span class="member" data-toggle="tooltip" data-title="&lt;T, S&gt;(selector: (input: S) =&gt; pz.Parser&lt;T, S&gt;) =&gt; pz.Parser&lt;T, S&gt;">choose</span></a><span class="punctuation">(</span>
    <span class="punctuation">(</span><span id="5712" data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">token</span><span class="punctuation">:</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="any">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#1200"><span class="typename" data-toggle="tooltip" data-title="pz.Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span></a><span class="punctuation">&gt;</span><span class="punctuation">)</span> <span class="punctuation">=&gt;</span> <span class="punctuation">{</span>
        <span class="keyword">switch</span> <span class="punctuation">(</span><a href="jsonparser.html#5712"><span data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">token</span></a><span class="punctuation">.</span><a href="../lexer.html#1438"><span data-toggle="tooltip" data-title="JsonToken">token</span></a><span class="punctuation">)</span> <span class="punctuation">{</span>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#637"><span data-toggle="tooltip" data-title="JsonToken.LeftBrace">LeftBrace</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#5129"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">object</span></a>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#660"><span data-toggle="tooltip" data-title="JsonToken.LeftBracket">LeftBracket</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#4314"><span data-toggle="tooltip" data-title="pz.Parser&lt;any[], pz.Token&lt;JsonToken&gt;&gt;">array</span></a>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#714"><span data-toggle="tooltip" data-title="JsonToken.String">String</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#2739"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">string</span></a>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#706"><span data-toggle="tooltip" data-title="JsonToken.Number">Number</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#2622"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">number</span></a>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#613"><span data-toggle="tooltip" data-title="JsonToken.True">True</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#2860"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">littrue</span></a>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#624"><span data-toggle="tooltip" data-title="JsonToken.False">False</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#2962"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">litfalse</span></a>
            <span class="keyword">case</span> <a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#631"><span data-toggle="tooltip" data-title="JsonToken.Null">Null</span></a><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#3068"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">litnull</span></a>
            <span class="keyword">default</span><span class="punctuation">:</span> <span class="keyword">return</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#11840"><span class="member" data-toggle="tooltip" data-title="&lt;T, S&gt;(found: string, ...expected: string[]) =&gt; pz.Parser&lt;T, S&gt;">fail</span></a><span class="punctuation">&lt;</span><span class="keyword">any</span><span class="punctuation">,</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="any">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#1200"><span class="typename" data-toggle="tooltip" data-title="pz.Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span><span class="punctuation">(</span><a href="jsonparser.html#5712"><span data-toggle="tooltip" data-title="pz.Token&lt;JsonToken&gt;">token</span></a><span class="punctuation">.</span><a href="../lexer.html#1456"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">,</span>
                <span class="string">&quot;{&quot;</span><span class="punctuation">,</span> <span class="string">&quot;[&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&lt;string&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&lt;number&gt;&quot;</span><span class="punctuation">,</span> <span class="string">&quot;true&quot;</span><span class="punctuation">,</span> <span class="string">&quot;false&quot;</span><span class="punctuation">,</span> <span class="string">&quot;null&quot;</span><span class="punctuation">)</span>
        <span class="punctuation">}</span>
    <span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;element&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>Finally we can define the root parser for JSON. It is just an <code>element</code>
parser preceded by optional whitespace.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">const</span> <span id="6458" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">json</span> <span class="punctuation">=</span> <a href="jsonparser.html#2546"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;[], pz.Token&lt;JsonToken&gt;&gt;">whitespace</span></a><span class="punctuation">.</span><a href="../parser.html#2035"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(other: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;">seq</span></a><span class="punctuation">(</span><a href="jsonparser.html#4047"><span data-toggle="tooltip" data-title="pz.Ref&lt;pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;&gt;">element</span></a><span class="punctuation">.</span><a href="../ref.html#750"><span class="member" data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">target</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../arrayparsers.html#775"><span class="member" data-toggle="tooltip" data-title="&lt;U&gt;(after: pz.Parser&lt;U, pz.Token&lt;JsonToken&gt;&gt;) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">followedBy</span></a><span class="punctuation">(</span><a href="jsonparser.html#3642"><span data-toggle="tooltip" data-title="pz.Parser&lt;pz.Token&lt;JsonToken&gt;, pz.Token&lt;JsonToken&gt;&gt;">eof</span></a><span class="punctuation">)</span><span class="punctuation">.</span><a href="../parser.html#8242"><span class="member" data-toggle="tooltip" data-title="(ruleName: string) =&gt; pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">trace</span></a><span class="punctuation">(</span><span class="string">&quot;json&quot;</span><span class="punctuation">)</span>
</code></pre>
<p>If you compare the definitions above to the official grammar in <a href="https://www.json.org">json.org</a>,
you'll find that they are almost identical. The only difference is that we
need to declare the rules bottom-up as you cannot refer to a rule which is
not yet defined. Otherwise it is almost mechanical exercise to convert the
grammar to Parzec combinators.</p>
<h2 id="exported-parsing-functions">Exported Parsing Functions</h2>
<p>First we provide a function that creates a lexer input stream for a JSON
string.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="6526" class="member" data-toggle="tooltip" data-title="(text: string) =&gt; pz.ParserInput&lt;pz.Token&lt;JsonToken&gt;&gt;">jsonInput</span><span class="punctuation">(</span><span id="7054" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="any">pz</span></a><span class="punctuation">.</span><a href="../input.html#0"><span class="typename" data-toggle="tooltip" data-title="pz.ParserInput&lt;S&gt;">ParserInput</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="any">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#1200"><span class="typename" data-toggle="tooltip" data-title="pz.Token&lt;S&gt;">Token</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span></a><span class="punctuation">&gt;</span><span class="punctuation">&gt;</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#5367"><span class="member" data-toggle="tooltip" data-title="&lt;S&gt;(text: string, lexer: pz.Lexer&lt;S&gt;, eof: pz.Token&lt;S&gt;) =&gt; pz.ParserInput&lt;pz.Token&lt;S&gt;&gt;">lexerInput</span></a><span class="punctuation">&lt;</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="JsonToken">JsonToken</span></a><span class="punctuation">&gt;</span><span class="punctuation">(</span><a href="jsonparser.html#7054"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">,</span> <a href="jsonparser.html#1549"><span data-toggle="tooltip" data-title="pz.Lexer&lt;JsonToken&gt;">lexer</span></a><span class="punctuation">,</span> 
        <span class="keyword">new</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../lexer.html#1200"><span class="typename" data-toggle="tooltip" data-title="typeof pz.Token">Token</span></a><span class="punctuation">(</span><a href="jsonparser.html#408"><span class="typename" data-toggle="tooltip" data-title="typeof JsonToken">JsonToken</span></a><span class="punctuation">.</span><a href="jsonparser.html#743"><span data-toggle="tooltip" data-title="JsonToken.EOF">EOF</span></a><span class="punctuation">,</span> <span class="string">&quot;&lt;end of input&gt;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>
</code></pre>
<p>Then we can define a function that takes a string and returns a JS object.
It throws an exception, if parsing fails. So, it works the same way as
<code>JSON.parse</code>.</p>
<pre class="syntaxhighlight narrow-scrollbars"><code><span class="keyword">export</span> <span class="keyword">function</span> <span id="7217" class="member" data-toggle="tooltip" data-title="(text: string) =&gt; any">parseJson</span><span class="punctuation">(</span><span id="7429" data-toggle="tooltip" data-title="string">text</span><span class="punctuation">:</span> <span class="keyword">string</span><span class="punctuation">)</span><span class="punctuation">:</span> <span class="keyword">any</span> <span class="punctuation">{</span>
    <span class="keyword">return</span> <a href="jsonparser.html#389"><span data-toggle="tooltip" data-title="typeof pz">pz</span></a><span class="punctuation">.</span><a href="../parser.html#11096"><span class="member" data-toggle="tooltip" data-title="&lt;T, S&gt;(parser: pz.Parser&lt;T, S&gt;, input: pz.ParserInput&lt;S&gt;) =&gt; T">parse</span></a><span class="punctuation">(</span><a href="jsonparser.html#6458"><span data-toggle="tooltip" data-title="pz.Parser&lt;any, pz.Token&lt;JsonToken&gt;&gt;">json</span></a><span class="punctuation">,</span> <a href="jsonparser.html#6526"><span class="member" data-toggle="tooltip" data-title="(text: string) =&gt; pz.ParserInput&lt;pz.Token&lt;JsonToken&gt;&gt;">jsonInput</span></a><span class="punctuation">(</span><a href="jsonparser.html#7429"><span data-toggle="tooltip" data-title="string">text</span></a><span class="punctuation">)</span><span class="punctuation">)</span>
<span class="punctuation">}</span>
</code></pre>

        </div>
            <div class="sidepane narrow-scrollbars">
                
        <div class="pagemenu">
            <h3>On This Page</h3>
                <ul class="pagetree">
                </ul>
        </div>
            </div>
        </div>
        
        <div class="footer">
            <a class="footer-button" href="exprtests.html">
            <p>Previous</p>
            <p>Â« Testing the Expression Parser</p>
        </a>
            <div class="footer-text">
                <p>Copyright Â© 2020 Tommi Johtela</p>
                <p>Generated by 
                    <a href="https://johtela.github.io/litscript">LiTScript</a>
                </p>
            </div>
            <a class="footer-button" href="jsontests.html">
            <p>Next</p>
            <p>Testing the JSON Parser Â»</p>
        </a>
        </div>
    
        <script src="../../dist/normal.js"></script>
    </body>
    </html>